<ng-template #taskModal>
  <app-create-task></app-create-task>
</ng-template>

<ng-template #details>
  <app-task-details [task]="selTask"></app-task-details>
</ng-template>

<div id="tasks" class="card bg-primary h-100">
  <div class="card-body h-100">

    <!--Task Top Bar-->
    <div id="task-top" class="row no-gutters mb-3">
      <h1 class="card-title text-light col-12 col-md-8">Current Tasks</h1>
      <div class="text-white col-12 col-md-4">
        <div id="task-buttons" class="d-flex justify-content-between">
          <button
            id="add-task-button"
            class="btn btn-secondary"
            type="button"
            (click)="open(taskModal)"
          >
            <span class="h3 bi bi-plus-circle"></span>
          </button>
          <button
            id="clear-completed-button"
            class="btn btn-secondary ml-2"
            type="button"
            (click)="clearTasks()"
          >
            <span class="h3 bi bi-trash2-fill"></span>
          </button>
          <button class="btn btn-secondary ml-2" (click)="exportTaskData()">
            <span class="h3 bi bi-cloud-arrow-down-fill"></span>
          </button>
        </div>
      </div>
    </div>

    <!--Tasks Table-->
    <table class="w-100 table table-striped text-white table-dark table-hover"
           style="border-radius: 20px !important">
      <thead class="bg-secondary font-weight-bold text-primary">
      <tr class="card-body rounded">
        <td *ngFor="let key of keys">
          {{tableFields[key]}}
        </td>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let task of tasks.slice(pageSize * (page - 1), pageSize * page)" class="bg-dark"
          [ngClass]="{'font-weight-bold text-secondary': task['user_id'] == auth.user.getValue().user_id}">
        <td *ngFor="let key of keys" (click)="selTask=task; key != 'state' ? open(details) : selTask=task">
          <div *ngIf="key != 'state'">
            <span>{{task[key]}}</span>
          </div>
          <div>
            <label for="task-state"></label>
            <select [name]="'task-' + task.task_id + 'state'" id="task-state"
                    *ngIf="key == 'state'" (change)="changeTaskState(task.task_id, $event.target.value)"
                    class="form-control p-0 text-light">
              <option value="2" [selected]="task[key] === 'Completed'" class="text-success">Completed</option>
              <option value="1" [selected]="task[key] === 'In-Progress'" class="text-warning">In-Progress</option>
              <option value="0" [selected]="task[key] === 'Not Started'">Not Started</option>
            </select>
          </div>
        </td>
      </tr>
      </tbody>
    </table>

    <!--Paging Buttons-->
    <div class="paging-buttons">
      <button class="btn btn-primary border-secondary btn-sm mr-3" type="button"
              [disabled]="page == 1"
              (click)="page = page - 1">Previous Page
      </button>
      <button class="btn btn-primary border-secondary btn-sm" type="button"
              [disabled]="page >= tasks.length/pageSize"
              (click)="page = page + 1">Next Page
      </button>
    </div>


    <!--Error Message-->
    <div class="card card-dark" *ngIf="errorMessage">
      <app-error></app-error>
    </div>


  </div>
</div>
